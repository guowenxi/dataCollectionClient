{"version":3,"file":"selectItemBox.88dcea3a.js","sources":["../src/components/TableInfo/fieldFile/selectItemBox.tsx"],"sourcesContent":["import React, {useState, useEffect, useContext} from 'react';\nimport styled, {ThemeProvider} from 'styled-components';\n\nimport {connect} from \"dva\";\nimport {useRequest} from 'ahooks';\nimport {Select as ASelect} from 'antd';\nimport type {Iconf} from '../TableInfo';\nimport {wrapContext} from '../TableInfo';\nimport {ShowData} from './_css_comm';\nimport {Form} from 'antd';\n\nimport {EventEmitter} from 'ahooks/lib/useEventEmitter';\n\nimport {joinUrl} from '@/utils/utils';\n\nconst {Option} = ASelect;\n\nconst InputNumberIntervalBox = styled.div`\n  .ant-form-item-control-input-content {\n    display: flex;\n\n    .ant-input-number {\n      width: 48%;\n      flex: 1;\n    }\n\n    .ant-divider {\n      min-width: 40px;\n      width: 40px;\n    }\n  }\n\n  .display-box {\n    display: flex;\n\n    .display-right-side-box {\n      flex: 7;\n\n      .ant-space-item {\n        flex: 1;\n\n        &:nth-child(2) {\n          flex: 0;\n          width: 20px;\n        }\n\n        .ant-divider-horizontal {\n          width: 20px;\n        }\n      }\n    }\n  }\n`;\n\nconst Label = styled.div<{ col?: string | number; style?: Record<string, any> | undefined }>`\n  flex: ${(props) => (props.col ? props.col : 3)};\n  position: relative;\n  /* ::after{\n    content:\"*\";\n    position: absolute;\n    left:0;\n    top:0;\n    color:red;\n  } */\n`;\n\nconst MSelect = styled(ASelect)`\n  && {\n    width: 100%;\n    height: 43px;\n\n    .ant-select-selector {\n      height: 100%;\n    }\n\n    .ant-select-selection-search-input {\n      height: 100% !important;\n    }\n\n    .ant-select-selection-item {\n      line-height: 43px;\n    }\n\n  }\n`;\n\ninterface Ioptions {\n  name: string,\n  id: number\n}\n\ninterface IconfSelect extends Iconf {\n  placeholder?: string,\n  relationType: string,\n  options: Ioptions[],\n  defaultValue: string\n}\n\ninterface ISelect {\n  dispatch: any;\n  conf: IconfSelect;\n  name: string;\n  rules: any;\n}\n\nconst Select: React.FC<ISelect> = (props) => {\n  const _: any = props.conf;\n  const {name} = props;\n  const {dispatch} = props\n  const theme: any = useContext(wrapContext);\n  const [OPTION, setOPTION] = useState([]);\n  const [VAL, setVAL] = useState(\"　\");\n\n  async function filterData(namespace: string, conf: any) {\n    let _op = [];\n    if (conf.relationType) {\n      _op = props[namespace][conf.relationType];\n    } else if (conf.url) {\n\n      const data = await dispatch({\n        type: 'common/requestData',\n        url: conf.url,\n        method: 'GET',\n        payload: {\n          ...conf.params\n        },\n      })\n\n      if (conf.keyName) {\n        data.map(function (item: any, idx: number) {\n          item.name = item[conf.keyName];\n          item.id = item[conf.idName];\n        })\n      }\n\n\n      // const { data, error, loading } = useRequest()\n      _op = data;\n    } else {\n      _op = conf.options;\n    }\n    setOPTION(_op);\n    filterDefaultValue(_op, _.defaultValue)\n  }\n\n  function filterDefaultValue(OPTION: Ioptions[], id: string) {\n    if (Number(id)) {\n      const val: any = OPTION.find(function (item) {\n        return Number(item.id) === Number(id);\n      })\n      setVAL(val.name)\n    }\n  }\n\n  // 只在初始化时进行加载\n  useEffect(() => {\n\n    filterData(\"select\", _)\n  }, [])\n\n  theme.event$.useSubscription((data: any) => {\n    const i = data.relateNames.indexOf(name);\n    if (i >= 0) {\n      switch (data.type) {\n        case \"onChange\":\n          if (!_.params) return;\n\n          console.log(\"useSubscription data\", data)\n          _.params[data.relatekeys[i]] = data.value;\n          theme.form.setFieldsValue({\n            [name]: [],\n          });\n\n\n          if (_.optionsKeyName) {\n            _.optionsList.map((item: any, index: number) => {\n              if (item[_.keyName] === data.value) {\n                setOPTION(item[_.optionsKeyName]);\n              }\n            })\n          } else {\n            filterData(\"select\", _)\n          }\n          break;\n      }\n    }\n  });\n\n\n  /// relateNames\n\n  return (\n    <wrapContext.Consumer>\n      {(_data: any): any => {\n        switch (_data.state) {\n          case 'default':\n            return <ShowData>{VAL}</ShowData>;\n            break;\n          case 'edit':\n          case \"new\" :\n          case 'disabled':\n            return (\n              <InputNumberIntervalBox>\n\n                <div className=\"display-box\">\n                  <Label\n                    style={{\n                      width: '100%'\n                    }}\n                    col={3}\n                    className=\"contentItem-name\"\n                  >\n                    <span className=\"required\">*</span>\n                    类型\n                  </Label>\n                  <div className=\"display-right-side-box\">\n                    <Form.Item\n                      rules={props.rules}>\n                      <MSelect\n                        placeholder={_.placeholder}\n                        showSearch\n                        disabled={_data.state === 'disabled'}\n                        onChange={(val) => {\n\n                        }}\n                        filterOption={(input, option: any) => {\n                          return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\n                        }}\n                      >\n                        {\n                          OPTION.map((item: any, idx: number) => {\n                            return <Option title={item.name}\n                                           value={item.id}>{item.name}</Option>\n                          })\n                        }\n                      </MSelect>\n                    </Form.Item>\n                  </div>\n                </div>\n              </InputNumberIntervalBox>\n\n            );\n            break;\n        }\n      }}\n    </wrapContext.Consumer>\n  );\n};\nexport default connect(({\n                          select\n                        }: { select: any }) => ({\n  select\n}))(Select);\n"],"names":["Option","ASelect","InputNumberIntervalBox","styled","Label","props","MSelect","Select","_","name","dispatch","theme","useContext","OPTION","useState","VAL","setVAL","filterData","namespace","conf","__async","_op","data","__spreadValues","item","idx","setOPTION","filterDefaultValue","OPTION2","id","val","useEffect","i","index","React","wrapContext","_data","ShowData","Form","input","option","selectItemBox","connect"],"mappings":"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"}
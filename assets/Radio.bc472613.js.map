{"version":3,"file":"Radio.bc472613.js","sources":["../src/components/TableInfo/fieldFile/Radio.tsx"],"sourcesContent":["import React, { useState, useEffect,useContext } from 'react';\nimport styled from 'styled-components';\n\nimport {connect} from \"dva\";\nimport { Radio as ARadio } from 'antd';\n\nimport type { Iconf} from '../TableInfo';\nimport { wrapContext } from '../TableInfo';\nimport { ShowData } from './_css_comm';\nimport { Form } from 'antd';\n\n\nconst WRadio = styled(ARadio.Group)`\n  width:100% !important;\n  height:100% !important;\n  border:1px solid #ccc;\n`;\n\nconst MRadio = styled(ARadio)`\n  && {\n    float: left;\n    /* height: 43px; */\n    position: relative;\n    top: 50%;\n    transform: translateY(-50%);\n    padding: 0 10px;\n    .ant-select-selector{\n      height:100%;\n    }\n    .ant-select-selection-search-input{\n      height:100% !important;\n    }\n  }\n`;\n\ninterface Ioptions {\n  name: string,\n  id: number\n}\ninterface IconfSelect extends Iconf {\n  placeholder?: string;\n  relationType: string;\n  options: Ioptions[];\n  defaultValue: string;\n  relateNames: string;\n  relatekeys: string;\n  clickType: string;\n\n}\ninterface IRadio {\n  dispatch?: any;\n  conf: IconfSelect;\n  name: string;\n  rules: any;\n}\n\nconst Radio: React.FC<IRadio> = (props) => {\n  const _: any = props.conf;\n  const {name} = props;\n  const {dispatch} = props;\n  const [OPTION, setOPTION ]  = useState([]);\n  const [VAL, setVAL]  = useState(\"　\");\n  const theme: any = useContext(wrapContext);\n\n  const data = theme.form.getFieldValue(name);\n\n  async function filterData(namespace: string,conf: any){\n    let _op = [];\n    if(conf.relationType){\n      _op = props[namespace][conf.relationType];\n    }else if(conf.url){\n\n      const data = await dispatch({\n        type: 'common/requestData',\n        url: conf.url,\n        method: 'GET',\n        payload: {\n          ...conf.params\n        },\n      })\n\n      if(conf.keyName){\n        data.map(function(item: any,idx: number){\n          item.name = item[conf.keyName];\n          item.id = item[conf.idName];\n        })\n      }\n      // const { data, error, loading } = useRequest()\n      _op = data;\n    }else{\n      _op = conf.options;\n    }\n    setOPTION(_op);\n    filterDefaultValue(_op,_.defaultValue)\n  }\n\n  function filterDefaultValue(OPTION: Ioptions[],id: string){\n    if(Number(id)){\n      const val: any =  OPTION.find(function(item){\n        return Number(item.id) ===Number(id);\n      })\n      setVAL(val?val.typeId:'')\n    }\n  }\n  // 只在初始化时进行加载\n  useEffect(()=>{\n    filterData(\"select\",_)\n  },[])\n\n  theme.event$.useSubscription((data: any) => {\n    const i= data.relateNames.indexOf(name);\n    if(i>=0){\n      switch(data.type){\n        case \"onChange\":\n          if( !_.url && !_.params ){\n            theme.form.setFieldsValue({\n              [name]:data.value,\n            });\n          }else{\n            _.params[data.relatekeys[i]] = data.value;\n            theme.form.setFieldsValue({\n              [name]:[],\n            });\n            if(_.optionsKeyName){\n              _.optionsList.map((item: any,index: number)=>{\n                if(item[_.keyName]===data.value){\n                  setOPTION(item[_.optionsKeyName]);\n                }\n              })\n            }else{\n              filterData(\"select\",_)\n            }\n          };\n          break;\n      }\n    }\n  });\n\n\n\n\n  /// relateNames\n\n  return (\n    <wrapContext.Consumer>\n      {(_data: any): any => {\n        switch (_data.state) {\n          case 'default':\n            return <ShowData>{_.defaultValue || '　'}</ShowData>;\n            break;\n          case 'edit':\n          case \"new\" :\n          case 'disabled':\n            return (\n              <Form.Item name={name}\n                         rules={props.rules}>\n                <WRadio disabled={_data.state === 'disabled'}\n                        onChange={(e)=>{\n                          if(_.relateNames){\n                            _data.focus$.emit({\n                              relateNames:_.relateNames,\n                              relatekeys:_.relatekeys,\n                              type:_.clickType ? _.clickType  : \"onChange\",\n                              value:e.target.value\n                            })\n                          }\n                        }}>\n                  {OPTION && OPTION.map((item: any,idx: number)=>{\n                    return <MRadio key={idx} value={item[_.idName || 'id']}>{item[_.keyName || 'name']}</MRadio>\n                  })}\n                </WRadio>\n              </Form.Item>\n\n            );\n            break;\n        }\n      }}\n    </wrapContext.Consumer>\n  );\n};\nexport default connect(({\n                          select\n                        }: {select: any}) => ({\n  select\n}))(Radio);\n"],"names":["WRadio","styled","ARadio","MRadio","Radio","props","_","name","dispatch","OPTION","setOPTION","setVAL","useState","theme","useContext","wrapContext","namespace","conf","__async","data","_op","data2","__spreadValues","item","idx","filterDefaultValue","OPTION2","id","val","useEffect","filterData","i","index","React","_data","ShowData","Form","e","Radio$1","connect"],"mappings":"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"}
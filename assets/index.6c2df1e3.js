var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var q=(r,a,o)=>a in r?ee(r,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[a]=o,p=(r,a)=>{for(var o in a||(a={}))le.call(a,o)&&q(r,o,a[o]);if(O)for(var o of O(a))re.call(a,o)&&q(r,o,a[o]);return r},_=(r,a)=>te(r,ae(a));import{_ as i,A as se,a as M,R as e,c as ne,W as ue,B as h,m as P}from"./index.353dd2ef.js";import{B as y}from"./index.96c6dfa7.js";import{F as m}from"./index.66f418cc.js";import{I as F}from"./index.4897d79a.js";import{C as oe,P as ce}from"./PoweroffOutlined.bd6b35c7.js";import{D as ie}from"./index.713bae6c.js";import{S as me}from"./index.698de9d8.js";import{T as Q,S as de}from"./Table.84915985.js";import{M as ge}from"./index.9307a5cf.js";import{E as pe}from"./EditOutlined.98c50555.js";import"./Pagination.79d24ff3.js";var Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855 160.1l-189.2 23.5c-6.6.8-9.3 8.8-4.7 13.5l54.7 54.7-153.5 153.5a8.03 8.03 0 000 11.3l45.1 45.1c3.1 3.1 8.2 3.1 11.3 0l153.6-153.6 54.7 54.7a7.94 7.94 0 0013.5-4.7L863.9 169a7.9 7.9 0 00-8.9-8.9zM416.6 562.3a8.03 8.03 0 00-11.3 0L251.8 715.9l-54.7-54.7a7.94 7.94 0 00-13.5 4.7L160.1 855c-.6 5.2 3.7 9.5 8.9 8.9l189.2-23.5c6.6-.8 9.3-8.8 4.7-13.5l-54.7-54.7 153.6-153.6c3.1-3.1 3.1-8.2 0-11.3l-45.2-45z"}}]},name:"arrows-alt",theme:"outlined"},Fe=Ee,W=function(a,o){return i.exports.createElement(se,M(M({},a),{},{ref:o,icon:Fe}))};W.displayName="ArrowsAltOutlined";var _e=i.exports.forwardRef(W);const C={url:"/fyHome/dws-ppl-particular-baseinfo/selectDwsPplParticularBaseinfoPage",params:{},checkBox:!0,operation:[{name:"\u8E22\u9664",type:"disabled",drawerWidth:"50"}],searchListType:"multipleQuery",searchList:[{title:"\u5173\u952E\u5B57",type:"input",key:"name",placeholder:"\u8BF7\u8F93\u5165"}],tableColumns:[{title:"IP\u5730\u5740",key:"ipPort",dataIndex:"ipPort",width:"10%",align:"center"},{title:"\u72B6\u6001",key:"status",dataIndex:"status",width:"10%",align:"center",render:r=>r?e.createElement(y,{status:"processing",text:"\u5DF2\u8FDE\u63A5"}):e.createElement(y,{status:"processing",text:"\u672A\u8FDE\u63A5"})},{title:"\u5FC3\u8DF3(s)",key:"heartbeat",dataIndex:"heartbeat",width:"10%",align:"center"},{title:"\u8FDE\u63A5\u65F6\u95F4",key:"connectionTime",dataIndex:"connectionTime",width:"10%",align:"center"}],mqttTableColumns:[{title:"\u5BA2\u6237\u7AEFID",key:"channelId",dataIndex:"channelId",width:"10%",align:"center"},{title:"\u7528\u6237\u540D",key:"name",dataIndex:"name",width:"10%",align:"center"},{title:"\u72B6\u6001",key:"status",dataIndex:"status",width:"10%",align:"center",render:r=>r?e.createElement(y,{status:"processing",text:"\u5DF2\u8FDE\u63A5"}):e.createElement(y,{status:"processing",text:"\u672A\u8FDE\u63A5"})},{title:"\u5FC3\u8DF3(s)",key:"heartbeat",dataIndex:"heartbeat",width:"10%",align:"center"},{title:"\u8FDE\u63A5\u65F6\u95F4",key:"connectionTime",dataIndex:"connectionTime",width:"10%",align:"center"}]},he="style-module__messageForwarding___T3ZcK",ye="style-module__box___jGE8g",be="style-module__banner___ReTqh",fe="style-module__logo___NgeHF",we="style-module__info___Jn9aj",Se="style-module__title___1ZUPS",Ae="style-module__btn___kO-gx",ve="style-module__detail___Fmo6F",xe="style-module__left___CH6-9",Ce="style-module__item___3fjH6",De="style-module__right___XZghE",ke="style-module__search___tzyG3";var c={messageForwarding:he,box:ye,banner:be,logo:fe,info:we,title:Se,btn:Ae,detail:ve,left:xe,item:Ce,right:De,search:ke,"m-box":"style-module__m-box___e2iuN","mb-row2":"style-module__mb-row2___C8cDi","mbr-left":"style-module__mbr-left___YZ5SS","mbr-right":"style-module__mbr-right___Ue-EQ","mb-biaoshi":"style-module__mb-biaoshi___QJLO4"},Ie="/assets/mqtt.3d0927c9.png";const{Column:D}=Q,Ne=r=>{var T,R;const{dispatch:a,select:o}=r,[L]=m.useForm(),[J,w]=i.exports.useState(!1),[d,k]=i.exports.useState({}),[I,S]=i.exports.useState([]);i.exports.useState(!0);const[b,A]=i.exports.useState(""),[j,v]=i.exports.useState(!1),[g,E]=i.exports.useState({}),[z,N]=i.exports.useState([]);i.exports.useState({pageNo:1}),i.exports.useState(0),i.exports.useEffect(()=>{x()},[]);const x=()=>{a({type:"common/getRequestData",method:"GET",url:"/data-acquisition/message-forwarding",payload:{},callback:t=>{if(t.success){let l=t.data;S(l),B("getSocketState",{moduleIds:null,pointIds:null,type:"sendSocketState"},l)}}})},H=t=>{A(t.serviceName),E(t),v(!0)},B=(t,l,s)=>{if(t==="getMQTTSubscribe"){G(l,s);return}const u=new WebSocket(`ws://${ue}:15420/ws/socket`);u.onmessage=n=>{if(console.log("\u5BA2\u6237\u7AEF\u63A5\u6536\u670D\u52A1\u7AEF\u6570\u636E\u65F6\u89E6\u53D1",n),n&&t==="getSocketState"&&V(n.data,s),n&&t==="getSocketServer"){console.log(JSON.parse(n.data));const f=n.data?JSON.parse(n.data):[];Z(f,s)}},u.onopen=n=>{console.log("\u5EFA\u7ACB\u8FDE\u63A5\u65F6\u89E6\u53D1",n),u.send(JSON.stringify(l))},u.onclose=n=>{console.log("\u8FDE\u63A5\u9519\u8BEF\u65F6\u89E6\u53D1",n)},u.onerror=n=>{console.log("\u901A\u4FE1\u9519\u8BEF\u65F6\u89E6\u53D1",n)}},V=(t,l)=>{const s=l.map(u=>u.id===1?_(p({},u),{status:t==="1"?"processing":"default",statusName:t==="1"?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"}):u);S(s)},Z=(t,l)=>{const s=t&&t.map(u=>JSON.parse(u));N(s),A(l.serviceName),E(l),w(!0)},G=(t,l)=>{a({type:"common/getRequestData",method:"get",url:"/dataCollect/mqttController/getRoutesAll",payload:{},callback:s=>{s.success&&(console.log(s),N([]),A(l.serviceName),E(l),w(!0))}})},U=t=>{a({type:"common/getRequestData",method:"post",url:"/dataCollect/SeocketController/removeClient",payload:{channelId:t.channelId},callback:l=>{l.success&&P.success("\u8E22\u9664\u6210\u529F")}})},$=t=>{console.log(t);let l=t.id===1?"/dataCollect/SeocketController/websocketServerAndStart":"";a({type:"common/getRequestData",method:"post",url:l,payload:{stopAndStart:t.status==="processing"?"0":"1"},callback:s=>{console.log(s);const u=_(p({},t),{status:s.data==="\u5DF2\u542F\u7528"?"processing":"default",statusName:s.data});E(u);const n=I.map(f=>f.id===t.id?u:f);S(n)}})},K=()=>{a({type:"common/getRequestData",method:"post",url:"/data-acquisition/message-forwarding/update",payload:p({},g),callback:t=>{console.log(t),t.success&&(v(!1),x())}})},X=t=>{console.log(t)},Y=()=>e.createElement("div",null,e.createElement("span",{style:{marginRight:"40px"}},b),e.createElement("span",{style:{marginRight:"40px",fontWeight:400}},"\u5DF2\u542F\u7528"),e.createElement("span",{style:{marginRight:"40px",fontWeight:400}},"\u7AEF\u53E3\u53F7: ",d.portNumber),b.includes("MQTT")?e.createElement(e.Fragment,null,e.createElement("span",{style:{marginRight:"40px",fontWeight:400}},"\u7528\u6237\u540D: ",d.username),e.createElement("span",{style:{marginRight:"40px",fontWeight:400}},"\u5BC6\u7801: ",d.password)):"");return e.createElement("div",{className:c.messageForwarding},e.createElement("div",{className:c.box},I.map((t,l)=>e.createElement("div",{key:l,className:c.banner},e.createElement("div",{className:c.logo},e.createElement("img",{src:Ie})),e.createElement("div",{className:c.info},e.createElement("div",{className:c.title},t.serviceName),e.createElement("div",null,"\u7AEF\u53E3\u53F7: ",t.portNumber),t.username?e.createElement(e.Fragment,null,e.createElement("div",null,"\u7528\u6237\u540D: ",t.username),e.createElement("div",{style:{display:"flex",alignItems:"center"}},"\u5BC6\u7801:",e.createElement(F.Password,{value:t.password,bordered:!1,style:{width:"100px"}}))):"",e.createElement("div",null,e.createElement(y,{status:t.status,text:t.statusName}))),e.createElement("div",{className:c.btn},e.createElement(h,{icon:e.createElement(pe,null),onClick:()=>{H(t)},type:"primary",ghost:!0},"\u7F16\u8F91"),e.createElement(h,{onClick:()=>{$(t)},icon:t.status==="processing"?e.createElement(oe,null):e.createElement(ce,null),type:t.status==="processing"?"danger":"primary",ghost:!0},t.status==="processing"?"\u505C\u7528":"\u542F\u7528"),e.createElement(h,{icon:e.createElement(_e,null),onClick:()=>{if(k(t),t.id===1&&t.statusName==="\u5DF2\u505C\u7528"){P.warning("\u8BF7\u5148\u542F\u7528\u670D\u52A1");return}B(t.id===1?"getSocketServer":"getMQTTSubscribe",{moduleIds:null,pointIds:null,type:"getSocketAllClientInformation"},t)},type:"primary",ghost:!0},"\u8FDE\u63A5\u7BA1\u7406"))))),e.createElement(ie,{title:Y(),placement:"right",onClose:()=>{k({}),w(!1),x()},visible:J,width:"60vw"},e.createElement("div",{className:c.detail},(T=d==null?void 0:d.serviceName)!=null&&T.includes("MQTT")?e.createElement("div",{className:c.left},e.createElement("div",{className:c.item},e.createElement("div",null,"Topic/getpointvalue"),e.createElement("div",null,e.createElement(me,{checkedChildren:"\u542F\u7528",unCheckedChildren:"\u7981\u7528",defaultChecked:d.status===1})))):"",e.createElement("div",{className:c.right},e.createElement("div",{className:c.search},e.createElement(m,{layout:"inline",form:L,onFinish:X},g.id===1?e.createElement(m.Item,{label:"IP\u5730\u5740",name:"moduleName"},e.createElement(F,{placeholder:"\u8BF7\u8F93\u5165IP\u5730\u5740"})):e.createElement(e.Fragment,null,e.createElement(m.Item,{label:"\u5BA2\u6237\u7AEFID",name:"clientId"},e.createElement(F,{placeholder:"\u8BF7\u8F93\u5165\u5BA2\u6237\u7AEFID"})),e.createElement(m.Item,{label:"\u7528\u6237\u540D",name:"username"},e.createElement(F,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}))),e.createElement(m.Item,null,e.createElement(h,{type:"primary",htmlType:"submit"},"\u67E5\u8BE2"),e.createElement(h,{htmlType:"button",onClick:()=>{},style:{marginLeft:"10px"}},"\u5237\u65B0")))),e.createElement("div",{className:c.body},e.createElement(Q,{rowKey:"channelId",dataSource:z,bordered:!0,pagination:!1},(R=d==null?void 0:d.serviceName)!=null&&R.includes("MQTT")?C.mqttTableColumns.map(t=>e.createElement(D,p({},t))):C.tableColumns.map(t=>e.createElement(D,p({},t))),e.createElement(D,{title:"\u64CD\u4F5C",align:"center",width:"10%",key:"action",render:(t,l)=>e.createElement(de,{size:"middle"},C.operation.map(s=>e.createElement("a",{onClick:()=>{U(l)}},s.name)))})))))),e.createElement(ge,{title:b+"\u7F16\u8F91",visible:j,onOk:()=>{K()},onCancel:()=>{v(!1)},style:{borderRadius:"5%"}},e.createElement(m,{layout:"vertical"},e.createElement(m.Item,{required:!0,label:"\u7AEF\u53E3\u53F7"},e.createElement(F,{value:g.portNumber,onChange:t=>{E(_(p({},g),{portNumber:t.target?t.target.value:t}))},placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7"})),b.includes("MQTT")?e.createElement(e.Fragment,null,e.createElement(m.Item,{required:!0,label:"IP\u5730\u5740"},e.createElement(F,{value:g.ipAddress,onChange:t=>{E(_(p({},g),{ipAddress:t.target?t.target.value:t}))},placeholder:"\u8BF7\u8F93\u5165IP\u5730\u5740"})),e.createElement(m.Item,{required:!0,label:"\u7528\u6237\u540D"},e.createElement(F,{value:g.username,onChange:t=>{E(_(p({},g),{username:t.target?t.target.value:t}))},placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"})),e.createElement(m.Item,{required:!0,label:"\u5BC6\u7801"},e.createElement(F.Password,{value:g.password,onChange:t=>{E(_(p({},g),{password:t.target?t.target.value:t}))},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"}))):"")))};var ze=ne(({common:r,select:a})=>({common:r,select:a}))(Ne);export{ze as default};

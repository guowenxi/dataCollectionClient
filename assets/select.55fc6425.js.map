{"version":3,"file":"select.55fc6425.js","sources":["../src/components/TableInfo/fieldFile/select.tsx"],"sourcesContent":["import React, {useState, useEffect, useContext} from 'react';\nimport styled, {ThemeProvider} from 'styled-components';\nimport {connect} from \"dva\";\nimport {useRequest} from 'ahooks';\nimport {Select as ASelect} from 'antd';\nimport type {Iconf} from '../TableInfo';\nimport {wrapContext} from '../TableInfo';\nimport {ShowData} from './_css_comm';\nimport {Form} from 'antd';\n\nimport {EventEmitter} from 'ahooks/lib/useEventEmitter';\n\nimport {joinUrl} from '@/utils/utils';\n\nconst {Option} = ASelect;\n\n\nconst MSelect = styled(ASelect)`\n  && {\n    width: 100%;\n    height: 100%;\n\n    .ant-select-selector {\n      height: 100%;\n      display: flex;\n      align-items: center;\n    }\n\n    .ant-select-selection-search-input {\n      height: 100% !important;\n    }\n\n  }\n`;\n\ninterface Ioptions {\n  name: string,\n  id: number\n}\n\ninterface IconfSelect extends Iconf {\n  placeholder?: string,\n  relationType: string,\n  options: Ioptions[],\n  defaultValue: string\n}\n\ninterface ISelect {\n  dispatch: any;\n  conf: IconfSelect;\n  name: string;\n  rules: any;\n}\n\nconst Select: React.FC<ISelect> = (props) => {\n  const _: any = props.conf;\n\n  const {name} = props;\n  const {dispatch} = props\n  const theme: any = useContext(wrapContext);\n  const [OPTION, setOPTION] = useState([]);\n  const [VAL, setVAL] = useState(\"　\");\n\n  async function filterData(namespace: string, conf: any) {\n    let _op = [];\n    if (conf.relationType) {\n      _op = props[namespace][conf.relationType];\n    } else if (conf.url) {\n\n      const data = await dispatch({\n        type: 'common/requestData',\n        url: conf.url,\n        method: 'GET',\n        payload: {\n          ...conf.params\n        },\n      })\n      if (conf.keyName) {\n        data.map(function (item: any, idx: number) {\n          item.name = item[conf.keyName];\n          item.id = item[conf.keyId];\n        })\n      }\n\n\n      // const { data, error, loading } = useRequest()\n      _op = data;\n    } else {\n      _op = conf.options;\n    }\n    setOPTION(_op);\n    filterDefaultValue(_op, _.defaultValue)\n  }\n\n  function filterDefaultValue(OPTION: Ioptions[], id: string) {\n    if (Number(id)) {\n      const val: any = OPTION.find(function (item) {\n        return Number(item.id) === Number(id);\n      })\n      setVAL(val.name)\n    }\n  }\n\n\n  // 只在初始化时进行加载\n  useEffect(() => {\n\n    filterData(\"select\", _)\n\n  }, [])\n\n  theme.event$.useSubscription((data: any) => {\n    const i = data.relateNames.indexOf(name);\n    if (i >= 0) {\n      switch (data.type) {\n        case \"onChange\":\n          if (!_.params) return;\n          _.params[data.relatekeys[i]] = data.value;\n          theme.form.setFieldsValue({\n            [name]: [],\n          });\n\n          if (_.optionsKeyName) {\n            _.optionsList.map((item: any, index: number) => {\n              if (item[_.keyName] === data.value) {\n                setOPTION(item[_.optionsKeyName]);\n              }\n            })\n          } else {\n            filterData(\"select\", _)\n          }\n          break;\n      }\n    }\n  });\n\n\n  /// relateNames\n\n  return (\n    <wrapContext.Consumer>\n      {(_data: any): any => {\n        switch (_data.state) {\n          case 'default':\n            return <ShowData>{VAL}</ShowData>;\n            break;\n          case 'edit':\n          case \"new\" :\n          case 'disabled':\n            return (\n              <Form.Item name={name} rules={props.rules}>\n                <MSelect\n                  placeholder={_.defaultValue === '' ? _.placeholder : _.placeholder}\n                  showSearch\n                  disabled={_data.state === 'disabled'}\n                  onChange={(val) => {\n                    if (_.relateNames) {\n                      _data.focus$.emit({\n                        relateNames: _.relateNames,\n                        relatekeys: _.relatekeys,\n                        type: _.clickType ? _.clickType : \"onChange\",\n                        value: val\n                      });\n                    }\n                  }}\n                  filterOption={(input, option: any) => {\n                    return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\n                  }}\n                >\n                  {\n                    OPTION.map((item: any, idx: number) => {\n                      return <Option title={item[_.keyName || 'name']}\n                                     value={item[_.keyId || 'id']}\n                                     key={item[_.keyId || 'id']}>{item[_.keyName || 'name']}</Option>\n                    })\n                  }\n                </MSelect>\n              </Form.Item>\n\n            );\n            break;\n        }\n      }}\n    </wrapContext.Consumer>\n  );\n};\nexport default connect(({\n                          select\n                        }: { select: any }) => ({\n  select\n}))(Select);\n"],"names":["Option","ASelect","MSelect","styled","Select","props","_","name","dispatch","theme","useContext","OPTION","useState","VAL","setVAL","filterData","namespace","conf","__async","_op","data","__spreadValues","item","idx","setOPTION","filterDefaultValue","OPTION2","id","val","useEffect","i","index","React","wrapContext","_data","ShowData","Form","input","option"],"mappings":"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"}
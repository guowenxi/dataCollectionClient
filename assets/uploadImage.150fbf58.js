var _=Object.defineProperty,N=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var h=(a,r,t)=>r in a?_(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,F=(a,r)=>{for(var t in r||(r={}))v.call(r,t)&&h(a,t,r[t]);if(T)for(var t of T(r))O.call(r,t)&&h(a,t,r[t]);return a},x=(a,r)=>N(a,k(r));var L=(a,r,t)=>new Promise((m,p)=>{var I=l=>{try{c(t.next(l))}catch(f){p(f)}},E=l=>{try{c(t.throw(l))}catch(f){p(f)}},c=l=>l.done?m(l.value):Promise.resolve(l.value).then(I,E);c((t=t.apply(a,r)).next())});import{c as j,_ as u,m as D,R as d}from"./index.3b0f1d22.js";import{s as C}from"./SearchMore.ed23b912.js";import{w as S}from"./index.f9227d92.js";import{G as M}from"./global.d3ce5ef4.js";import{A as R}from"./index.df30e509.js";import{F as $}from"./index.956cef20.js";import{M as V}from"./index.562b58ba.js";import"./index.465b72ea.js";import"./index.62eb6faf.js";import"./index.5e38d70a.js";import"./index.09976468.js";import"./Table.3fbe1f2c.js";import"./Pagination.8e24f235.js";import"./index.b72b64bd.js";import"./index.dba719dc.js";import"./utils.abb32d8d.js";import"./DeleteOutlined.d5f3a609.js";const{rootUrl:w,rbacToken:A}=M,W=C(R)`
  .ant-upload-select-picture-card {
    display: ${a=>a.disabled?"none":"table"};
  }
`,G=C.div`
  && {
    height: 100%;
    padding: 1vh;
    border: 1px solid #d9d9d9;
  }
`,B=a=>{const r=a.conf,{name:t}=a,[m,p]=u.exports.useState([]),[I,E]=u.exports.useState({}),[c,l]=u.exports.useState(!1),[f,b]=u.exports.useState(""),y=u.exports.useContext(S),U=function(s){let o=[];switch(typeof s){case"string":o==""?o=[]:o=s.split(",");break;case"object":o=s;break;default:o=[];break}return o===null?[]:o.length>0?o.map(function(e){return x(F({},e),{uid:e.fileId?e.fileId:e,fileId:e.fileId?e.fileId:"",name:e.fileName?e.fileName:"",status:"done",fileType:e.contentType?e.contentType:"",url:`${w}/fyHome/file/download?id=${e.fileId?e.fileId:e}&rbacToken=${A}`})}):o};function P(s){return new Promise((o,e)=>{const n=new FileReader;n.readAsDataURL(s),n.onload=()=>o(n.result),n.onerror=g=>e(g)})}return u.exports.useMemo(()=>{const s=y.form.getFieldValue(t),o=U(s);p(o),E({name:"file",action:w+r.uploadUrl,listType:"picture-card",headers:{},data:{rbacToken:A},beforeUpload:e=>{const n=e.type==="image/jpeg"||e.type==="image/jpg"||e.type==="image/png";return n||D.warning("\u53EA\u80FD\u4E0A\u4F20jpg/png\u683C\u5F0F\u7684\u56FE\u7247"),n||R.LIST_IGNORE},onRemove(){},onChange(e){const n=e.fileList;let g=[];e.file.status,e.file.status==="done"||e.file.status==="removed"?(console.log(e.fileList),e.fileList.map(i=>{g.push({fileName:i.fileName?i.fileName:i.response.data.fileName,fileId:i.fileId?i.fileId:i.response.data.fileId,fileUrl:i.fileUrl?i.fileUrl:i.response.data.fileUrl})}),y.form.setFieldsValue({[t]:g})):e.file.status,p([...n])},progress:{strokeColor:{"0%":"#108ee9","100%":"#87d068"},strokeWidth:3,format:e=>`${parseFloat(e.toFixed(2))}%`}})},[]),d.createElement(S.Consumer,null,s=>d.createElement($.Item,{name:t,rules:a.rules},d.createElement(G,null,d.createElement(W,x(F({listType:"picture"},I),{fileList:m,disabled:s.state==="disabled",accept:"image/*",maxCount:r.maxCount,onPreview:o=>L(void 0,null,function*(){l(!0),o.originFileObj?b(yield P(o.originFileObj)):b(o.url)})}),m.length>=r.maxCount?null:"\u4E0A\u4F20\u56FE\u7247"),d.createElement(V,{visible:c,title:null,footer:null,onCancel:()=>l(!1)},d.createElement("img",{alt:"example",style:{width:"100%"},src:f})))))};var ue=j(({})=>({}))(B);export{ue as default};
//# sourceMappingURL=uploadImage.150fbf58.js.map

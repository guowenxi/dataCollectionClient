{"version":3,"file":"selectType.f8c3570f.js","sources":["../src/components/TableInfo/fieldFile/selectType.tsx"],"sourcesContent":["import React, {useState, useEffect, useContext} from 'react';\nimport styled, {ThemeProvider} from 'styled-components';\nimport {connect} from \"dva\";\nimport {useRequest} from 'ahooks';\nimport {Select as ASelect, Badge} from 'antd';\nimport type {Iconf} from '../TableInfo';\nimport {wrapContext} from '../TableInfo';\nimport {ShowData} from './_css_comm';\nimport {Form} from 'antd';\n\nimport {EventEmitter} from 'ahooks/lib/useEventEmitter';\n\nimport {joinUrl} from '@/utils/utils';\n\nconst {Option} = ASelect;\n\n\nconst MSelect = styled(ASelect)`\n  && {\n    width: 100%;\n    height: 100%;\n\n    .ant-select-selector {\n      height: 100%;\n      display: flex;\n      align-items: center;\n    }\n\n    .ant-select-selection-search-input {\n      height: 100% !important;\n    }\n\n  }\n`;\n\ninterface Ioptions {\n  name: string,\n  id: number\n}\n\ninterface IconfSelect extends Iconf {\n  placeholder?: string,\n  relationType: string,\n  options: Ioptions[],\n  defaultValue: string\n}\n\ninterface ISelect {\n  dispatch: any;\n  conf: IconfSelect;\n  name: string;\n  rules: any;\n}\n\nconst Select: React.FC<ISelect> = (props) => {\n  const _: any = props.conf;\n\n  const {name} = props;\n  const {dispatch} = props\n  const theme: any = useContext(wrapContext);\n  const [OPTION, setOPTION] = useState([]);\n  const [VAL, setVAL] = useState(\"　\");\n\n  async function filterData(namespace: string, conf: any, keyWord: any) {\n    let _op = [];\n    if (conf.relationType) {\n      _op = props[namespace][conf.relationType];\n    } else if (conf.url) {\n\n\n      let startTime_endTime = theme.form.getFieldValue(conf.params.keyName)\n      let developTime = \"\"\n      let startTime = \"\"\n      let endTime = \"\"\n\n      let params = {};\n\n      if (startTime_endTime === null || startTime_endTime === \"\" || startTime_endTime === undefined) {\n        params = {\n          ...conf.params,\n          siteName: keyWord\n        }\n      } else {\n\n        startTime = startTime_endTime[0].format(\"YYYY/MM/DD HH:mm\");\n        endTime = startTime_endTime[1].format(\"YYYY/MM/DD HH:mm\");\n        developTime = startTime_endTime[0].format(\"YYYY/MM/DD HH:mm\") + '-' + startTime_endTime[1].format(\"YYYY/MM/DD HH:mm\");\n\n        params = {\n          ...conf.params,\n          siteName: keyWord,\n          'developTime': developTime,\n          'startTime': startTime,\n          'endTime': endTime\n        }\n      }\n      const data = await dispatch({\n        type: 'common/requestData',\n        url: conf.url,\n        method: 'GET',\n        payload: params,\n      })\n\n      if (conf.keyName) {\n        data.map(function (item: any, idx: number) {\n          item.name = item[conf.keyName];\n          item.id = item[conf.keyId];\n          item.siteStatus = item.siteStatus\n          item.siteStatusName = item.siteStatusName\n        })\n      }\n\n\n      // const { data, error, loading } = useRequest()\n      _op = data;\n    } else {\n      _op = conf.options;\n    }\n    console.log(_op)\n    setOPTION(_op);\n    filterDefaultValue(_op, _.defaultValue)\n  }\n\n  function filterDefaultValue(OPTION: Ioptions[], id: string) {\n    if (Number(id)) {\n      const val: any = OPTION.find(function (item) {\n        return Number(item.id) === Number(id);\n      })\n      setVAL(val.name)\n    }\n  }\n\n\n  // 只在初始化时进行加载\n  useEffect(() => {\n\n    filterData(\"select\", _, '')\n\n  }, [])\n\n  theme.event$.useSubscription((data: any) => {\n    const i = data.relateNames.indexOf(name);\n    if (i >= 0) {\n      switch (data.type) {\n        case \"onChange\":\n          if (!_.params) return;\n          _.params[data.relatekeys[i]] = data.value;\n          theme.form.setFieldsValue({\n            [name]: [],\n          });\n\n          if (_.optionsKeyName) {\n            _.optionsList.map((item: any, index: number) => {\n              if (item[_.keyName] === data.value) {\n                setOPTION(item[_.optionsKeyName]);\n              }\n            })\n          } else {\n            filterData(\"select\", _)\n          }\n          break;\n      }\n    }\n  });\n\n  return (\n    <wrapContext.Consumer>\n      {(_data: any): any => {\n        switch (_data.state) {\n          case 'default':\n            return <ShowData>{VAL}</ShowData>;\n            break;\n          case 'edit':\n          case \"new\" :\n          case 'disabled':\n            return (\n              <Form.Item name={name} rules={props.rules}>\n                <MSelect\n\n                  placeholder={_.defaultValue === '' ? _.placeholder : _.placeholder}\n                  disabled={_data.state === 'disabled'}\n                  onChange={(val) => {\n                    if (_.relateNames) {\n                      _data.focus$.emit({\n                        relateNames: _.relateNames,\n                        relatekeys: _.relatekeys,\n                        type: _.clickType ? _.clickType : \"onChange\",\n                        value: val\n                      });\n                    }\n                  }}\n                  showSearch\n                  optionLabelProp=\"label\"\n                  optionFilterProp=\"children\"\n                  onSearch={(input) => {\n                    // onSearch(input)\n\n                    filterData(\"select\", _, input)\n\n                  }}\n                  filterOption={(input, option) => {\n                    return true\n                  }}\n                >\n                  {\n                    OPTION.map((item: any, idx: number) => {\n                      return <Option title={item[_.keyName || 'name']}\n                                     value={item[_.keyId || 'id']}\n                                     key={item[_.keyId || 'id']} label={item[_.keyName || 'name']}\n                                     disabled={item.siteStatus === 1 ? true : false}\n\n\n                      >\n\n\n                        <div style={{display: 'flex'}}>\n\n                          <span aria-label={item[_.keyName || 'name']}\n                                style={{width: '90%'}}>{item[_.keyName || 'name']}</span>\n\n                          {\n                            item.siteStatus === 0 ? <Badge status='success' aria-label={item[_.keyName || 'name']}\n                                                           text={item.siteStatusName}/>\n                              : <Badge status=\"error\" aria-label={item[_.keyName || 'name']} text={item.siteStatusName}\n                                       style={{color: '#ccc'}}/>\n                          }\n\n                        </div>\n\n                      </Option>\n                    })\n                  }\n                </MSelect>\n              </Form.Item>\n\n            );\n            break;\n        }\n      }}\n    </wrapContext.Consumer>\n  );\n};\nexport default connect(({\n                          select\n                        }: { select: any }) => ({\n  select\n}))(Select);\n"],"names":["Option","ASelect","MSelect","styled","Select","props","_","name","dispatch","theme","useContext","OPTION","useState","VAL","filterData","namespace","conf","keyWord","__async","_op","startTime_endTime","developTime","startTime","endTime","params","__spreadProps","__spreadValues","data","item","idx","setOPTION","filterDefaultValue","OPTION2","id","val","setVAL","useEffect","i","index","React","wrapContext","_data","ShowData","Form","input","option","Badge"],"mappings":"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"}
{"version":3,"file":"upload.54e67e10.js","sources":["../node_modules/_@ant-design_icons-svg@4.2.1@@ant-design/icons-svg/es/asn/UploadOutlined.js","../node_modules/_@ant-design_icons@4.8.0@@ant-design/icons/es/icons/UploadOutlined.js","../src/components/TableInfo/fieldFile/upload.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar UploadOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"upload\", \"theme\": \"outlined\" };\nexport default UploadOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UploadOutlinedSvg from \"@ant-design/icons-svg/es/asn/UploadOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UploadOutlined = function UploadOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UploadOutlinedSvg\n  }));\n};\nUploadOutlined.displayName = 'UploadOutlined';\nexport default /*#__PURE__*/React.forwardRef(UploadOutlined);","import React, {useState, useEffect, useMemo, useContext} from 'react';\nimport styled, {ThemeProvider} from 'styled-components';\n\nimport {connect} from \"dva\";\nimport {Upload as AUpload, Button, message} from 'antd';\nimport {UploadOutlined} from '@ant-design/icons';\nimport type {Iconf} from '../TableInfo';\nimport {wrapContext} from '../TableInfo';\nimport {ShowData} from './_css_comm';\nimport {Form} from 'antd';\nimport {G} from '@/global';\n\nconst {rootUrl, rbacToken} = G;\n\nconst MUpload = styled(AUpload)``;\nconst WrapBox = styled.div`\n  && {\n    border: 1px solid #d9d9d9;\n    padding: 1vh;\n    height: 100%;\n  }\n`;\n\ninterface IconfInput extends Iconf {\n  placeholder?: string;\n}\n\ninterface Iinput {\n  dispatch?: any;\n  conf: IconfInput;\n  name: string;\n  rules: any;\n}\n\nconst Input: React.FC<Iinput> = (props) => {\n  const _: any = props.conf;\n  const {name} = props;\n  const [FILELIST, setFILELIST] = useState<any>([]);\n  const [PROPS, setPROPS] = useState({});\n  const [uploadStatus, setUploadStatus] = useState();\n  const theme: any = useContext(wrapContext);\n  const filterData = function (data: any) {\n    let _data: any = [];\n    switch (typeof data) {\n      case 'string':\n        data == '' ? _data = [] : _data = data.split(',');\n        break;\n      case 'object':\n        _data = data;\n        break;\n      default:\n        _data = [];\n        break;\n    }\n\n    if(_data === null){\n      return [];\n    }\n    if (_data.length > 0) {\n\n      return _data.map(function (item: any, idx: number) {\n        return {\n          ...item,\n          uid: item.fileId ? item.fileId : item,\n          fileId: item.fileId ? item.fileId:'',\n          name: item.fileName ? item.fileName : '',\n          status: 'done',\n          fileType: item.contentType ? item.contentType : \"\",\n          url: `${rootUrl}/fyHome/file/download?id=${item.fileId ? item.fileId : item}&rbacToken=${rbacToken}`,\n        }\n      })\n    }\n    return _data;\n  };\n\n  // 用 useEffect 父组件更新，子组件也会更新（性能很差）\n  // 需要用 useMemo 来解决\n  useMemo(() => {\n    const formData = theme.form.getFieldValue(name);\n    const data = filterData(formData);\n    // 暂时因为数据会回显 导致这个获取到的data是文件的data, 所以暂时这样做判断\n\n\n    setFILELIST(data);\n    setPROPS({\n      name: 'file',\n      action: rootUrl + _.uploadUrl,\n      // listType: 'picture-card',\n      headers: {\n        // authorization: 'authorization-text',\n      },\n      data: {\n        rbacToken: rbacToken\n      },\n      onRemove(item: any) {\n      },\n      onChange(info: any) {\n\n        const formData = theme.form.getFieldValue(name);\n        console.log(formData);\n\n        const files: any = info.fileList;\n        let arr: any[] = [];\n        if (info.file.status === 'uploading') {\n          // message.error(`${info.file.name} uploading`);\n\n          setUploadStatus(info.file.status)\n        }\n        if (info.file.status === 'done' || info.file.status === 'removed') {\n\n          console.log(info.fileList)\n          info.fileList.map(item => {\n            arr.push({\n              fileName: item.fileName ? item.fileName : item.response.data.fileName,\n              fileId: item.fileId ? item.fileId : item.response.data.fileId,\n              fileUrl: item.fileUrl ? item.fileUrl : item.response.data.fileUrl\n            });\n          })\n\n          theme.form.setFieldsValue({\n            [name]: arr,\n          });\n          setUploadStatus('');\n\n        } else if (info.file.status === 'error') {\n          // message.error(`${info.file.name} error`);\n          setUploadStatus('');\n        }\n\n\n        setFILELIST([...files]);\n      },\n      progress: {\n        strokeColor: {\n          '0%': '#108ee9',\n          '100%': '#87d068',\n        },\n        strokeWidth: 3,\n        format: (percent: any) => `${parseFloat(percent.toFixed(2))}%`,\n      },\n    });\n  }, []);\n\n  return (\n    <wrapContext.Consumer>\n      {(_data) => {\n        return (\n          <Form.Item name={name} rules={props.rules}>\n            <WrapBox>\n              <MUpload {...PROPS} fileList={FILELIST} maxCount={_.maxCount}\n                       accept={_.accept}\n                       disabled={_data.state === 'disabled'}\n              >\n                {_data.state == 'edit' || _data.state == 'new' ? (\n                  <Button\n                    disabled={FILELIST.length === _.maxCount ? true : (uploadStatus === 'uploading' ? true : false)}>\n                    <UploadOutlined/> {uploadStatus === 'uploading' ? '上传中' : '点击上传文件'}\n                  </Button>\n                ) : null}\n              </MUpload>\n\n\n            </WrapBox>\n\n          </Form.Item>\n        );\n      }}\n    </wrapContext.Consumer>\n  );\n};\nexport default connect(({}) => ({}))(Input);\n"],"names":["UploadOutlined","UploadOutlinedSvg","props","ref","React.createElement","AntdIcon","_objectSpread","UploadOutlined$1","React.forwardRef","rootUrl","rbacToken","G","MUpload","styled","AUpload","WrapBox","Input","_","name","setFILELIST","useState","PROPS","setPROPS","uploadStatus","setUploadStatus","theme","useContext","wrapContext","filterData","data","_data","item","idx","__spreadProps","__spreadValues","useMemo","formData","formData2","files","info","arr","percent","React","Form","FILELIST","Button"],"mappings":"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"}